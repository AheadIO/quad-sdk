#include "spirit_utils/trajectory_visualization_publisher.h"

TrajectoryVisualizationPublisher::TrajectoryVisualizationPublisher(ros::NodeHandle nh) {
  nh_ = nh;

  // Load rosparams from parameter server
  std::string ground_truth_state_topic;

  spirit_utils::loadROSParam(nh_,"topics/ground_truth_state",ground_truth_state_topic);

  // Setup pubs and subs
  ground_truth_state_pub_ = nh_.advertise<spirit_msgs::StateEstimate>(ground_truth_state_topic,1);

  // loadCSV();

  iterationCount = -1;

}

void TrajectoryVisualizationPublisher::loadCSV() {
  int a = 0;
}

spirit_msgs::StateEstimate TrajectoryVisualizationPublisher::updateStep() {
  spirit_msgs::StateEstimate new_state_est;

  // Hardcode in traj for now

  // Jump

  // static const double q1_T[] = {0.701158, 0.7003792716739764, 0.6985824392060491, 0.6958121182245425, 0.6921132168334012, 0.6872219613804207, 0.6815357795403034, 0.6751555773892726, 0.6681324348863569, 0.6603546975196519, 0.6520587907254946, 0.6433571894692421, 0.6342961893219655, 0.6248588427461719, 0.6151685708295205, 0.6053109260570309, 0.5953194442710853, 0.5852176230630453, 0.5750645346139583, 0.564897112815593, 0.5547295655776879, 0.5445783836358062, 0.5344430311817265, 0.5242922207322234, 0.5140904230586663, 0.503770997526151, 0.49332386348068774, 0.4846847137995221, 0.4801345187409375, 0.4829803393649094, 0.5042502506373132, 0.5457296031546269, 0.6053458946050521, 0.6802641896274991, 0.7380948921011908, 0.7732687129404985, 0.7921424787599437, 0.8006818368596973, 0.8017497808557148, 0.799244736460416, 0.7942754536893513, 0.7876139145844949, 0.7800307424979233, 0.7725755918640131, 0.7655681686137941, 0.7592416494545913, 0.7541069644351861, 0.7501822131331052, 0.7472500281115134, 0.7452508823520895, 0.744225346503083, 0.743794644347425, 0.7435440292162546, 0.7432512268165025, 0.7425430832121644, 0.7408172997538892, 0.7380048185567688, 0.733957424824243, 0.728358011534141, 0.7208108701046139, 0.7122921379014129, 0.7037136516934818, 0.6963567519466036, 0.6974770304247422, 0.7145429026485213, 0.753888433162818, 0.8219404732327443, 0.7631636955482126, 0.7075670614991926, 0.6554910818038723, 0.6072619296544324, 0.564994348588784, 0.5274475602852041, 0.4944097757290281, 0.4659082772687727, 0.44346240571441936, 0.4257626965524884, 0.4120543982956844, 0.40209942401412363, 0.39640434625977194, 0.3937273538856703, 0.39316157766333887, 0.3944906099917188, 0.39805118549818236, 0.40407233006099186, 0.41213052640917647, 0.42221974970276804, 0.43464216890678004, 0.4493858030815118, 0.46566863282965365, 0.4832848320102554, 0.5020812576296337, 0.5215603778219557, 0.5409437933504624, 0.5598141522664997, 0.5776310560235383, 0.5926710302724377, 0.60466752671205, 0.6129225714745142, 0.6167266343855909};
  // static const double q2_T[] = {1.415082, 1.4171800647694917, 1.421931129676328, 1.4291224300086767, 1.4385413029901275, 1.4505732892505498, 1.4641518537872975, 1.4789703940173202, 1.4948323749014436, 1.5116793052024085, 1.5289602302154315, 1.5464200173704314, 1.5638895460940607, 1.5810402753050765, 1.5975451746168505, 1.6132896994947072, 1.6281145964578607, 1.6415177870737423, 1.6531135746587984, 1.662993917718876, 1.6709761611924063, 1.6764288147419444, 1.6785866101054434, 1.6778279172715713, 1.6738882038306535, 1.6660138605501429, 1.6523764026041634, 1.6324439976583323, 1.6041092850571694, 1.5641008783608545, 1.4997852562475786, 1.4090795620503371, 1.2941016628519948, 1.157879097796342, 1.0760711194969133, 1.056278543436139, 1.079139727392701, 1.126665449612498, 1.191418327300012, 1.26436995740399, 1.3429560338468034, 1.4253898982747963, 1.5098790893145477, 1.5939882463926662, 1.676915930822036, 1.7580381612922895, 1.8358273740199018, 1.9097455721850247, 1.9799527561422168, 2.046145527283471, 2.1068649256176166, 2.161449478855802, 2.2106476995436237, 2.254162613238783, 2.290517679741103, 2.3182381793692093, 2.3388014502688437, 2.3518288749677594, 2.3558710682255417, 2.344202623887087, 2.314629636413395, 2.2628801156463982, 2.18245676767188, 2.0499012286233844, 1.8648448292354205, 1.620908396941032, 1.3120104018599157, 1.373484280467558, 1.4267388549258182, 1.4724961163946924, 1.511456008150651, 1.5421336467169469, 1.567416884489648, 1.5879861682631713, 1.6041760725158518, 1.6151313801076426, 1.6223714828841977, 1.6266346278082686, 1.6282070013879004, 1.626881914381334, 1.6236047762215666, 1.6190135847931135, 1.613290135470549, 1.6063204374360927, 1.5980626321336302, 1.588772530651019, 1.5784725576398237, 1.5670387320459145, 1.5545124731270212, 1.5412900550448292, 1.5274908092372803, 1.5132264055776172, 1.4988418452511414, 1.484737630075193, 1.4711776106765881, 1.4585184486088585, 1.4479555741506125, 1.4395854192943915, 1.4338601064462961, 1.4312385026654715};
  // static const double q3_T[] = {0.640798, 0.6393570066391284, 0.6360843369251585, 0.6311153381219674, 0.6245850291344275, 0.6161827955768846, 0.6066264461833398, 0.596108042290958, 0.5847404731343743, 0.5724607498112253, 0.5596296500201716, 0.5464131807057623, 0.532897985132638, 0.5191638029573087, 0.5054101450069665, 0.49174825861931293, 0.47826092840175904, 0.4651403751968399, 0.45259992237523117, 0.4406759253010864, 0.4294779374989407, 0.41931582517362637, 0.41062262668752947, 0.4033132085087405, 0.3975703989240772, 0.39384392084212566, 0.3932753629446458, 0.39638743848216207, 0.4045048710296538, 0.4196543101516685, 0.4492381951203334, 0.4937869477964651, 0.5514014481671607, 0.619611872021851, 0.6683256113360768, 0.6975825680753146, 0.7137341070380938, 0.7225437425997552, 0.7236505146676732, 0.7207501261439494, 0.7149378459358898, 0.7069661003723074, 0.6975092658060763, 0.6878622526930838, 0.6784962488990545, 0.669748712807069, 0.6623533266433285, 0.6566326784931127, 0.6525239311456102, 0.6501459680949597, 0.6500682049003303, 0.6523983430293989, 0.656687345954947, 0.6629239449500504, 0.6714116657299618, 0.6822610746975561, 0.6948536293605582, 0.7091448433064702, 0.7252793195412252, 0.7436187898968297, 0.7639173580372862, 0.7870262781762132, 0.8143320591700947, 0.8550973230946395, 0.9152661039445349, 0.9996549335885109, 1.112988445936333, 1.0598761175699565, 1.0123492880769873, 0.9698180486005492, 0.9317221967620586, 0.8990785300068438, 0.8700822647228238, 0.8443303154598051, 0.8216454734725435, 0.8027358986634652, 0.7865984719561422, 0.7727344960570682, 0.7609714133086432, 0.7515665478949146, 0.7438769061042357, 0.7374251316608524, 0.7320933427828797, 0.7280399411745937, 0.7252769847960375, 0.7235456647229191, 0.7228285293163099, 0.7232665797853587, 0.7248781535171768, 0.7273085389932452, 0.7304884892848966, 0.7344029395692349, 0.738956980109644, 0.7437780389739369, 0.748719483196402, 0.7536080867172329, 0.7579280390626238, 0.7614491033826676, 0.7639168846521736, 0.7650730387879959};
  // static const double q4_T[] = {1.376033, 1.3791213591075475, 1.3860684704124935, 1.3965129924387216, 1.410094445385586, 1.4272170741654973, 1.4463308628101341, 1.4669864355495954, 1.4888851688490328, 1.511841837045017, 1.5351412433467968, 1.5584640427028125, 1.5815829677312512, 1.6039986546543001, 1.6253045811756668, 1.6453839918349487, 1.6640207048652051, 1.6804811237375425, 1.6942098478243064, 1.7053437390101465, 1.7135947502275364, 1.7179739711143522, 1.7172022589158533, 1.711749568200014, 1.701080259460127, 1.6837907426582892, 1.6565778304172873, 1.6208881744747519, 1.576012857097942, 1.5205695641763732, 1.447274832553598, 1.3559625406917226, 1.2485775177642446, 1.1276854709697228, 1.0667097741718998, 1.0587930044146754, 1.0840815723618802, 1.124742115809358, 1.1829090211600688, 1.2502009942108188, 1.3241378243830533, 1.403024225292597, 1.4854209001566794, 1.5684828209667385, 1.651191096146331, 1.7328355073407922, 1.811939666755384, 1.8877299974601596, 1.9601943272219657, 2.028963741319188, 2.0925396283437077, 2.1501003389810123, 2.2022557531844473, 2.248617872816288, 2.2875343780408586, 2.317189995604811, 2.338948744328213, 2.3522065860732795, 2.355050963926803, 2.338568007209145, 2.2994804582849158, 2.2320960138633, 2.1278177600217374, 1.953906546939735, 1.7170749048393077, 1.4152843301380797, 1.0471975511966023, 1.1077254701878403, 1.155070924833729, 1.1918531533578984, 1.2205689460520874, 1.2417047210076075, 1.2590961505192502, 1.2736779376972072, 1.286058441078042, 1.2964721936953765, 1.3058995262424626, 1.314676898776426, 1.322964217128125, 1.3308167549007548, 1.3383197197722725, 1.345538803069807, 1.3525281614217028, 1.3594289912922528, 1.366602839258622, 1.374144126195839, 1.3821266729344832, 1.3907095738670516, 1.3999682382381253, 1.4096924003490694, 1.419818284548688, 1.430287362866782, 1.4408710876280773, 1.451275608639204, 1.4613093947363516, 1.4707141590651505, 1.478618925246173, 1.4849226322140032, 1.4892614035088876, 1.4912637456505304};

  // static const double x_T[] = {0.0, 4.709561781480408e-05, 0.00016063541735551314, 0.0003430751492534675, 0.0005968604543318853, 0.0009573040113877158, 0.0014025905432124477, 0.0019309345876934957, 0.0025450514187279633, 0.0032819681575467123, 0.004127733018357049, 0.005075996690372445, 0.006131221200850856, 0.007334985139593031, 0.008687279829619964, 0.010175624861662364, 0.0118080588502174, 0.013634365702233744, 0.015679701671376733, 0.017921220450602297, 0.020373536159969077, 0.023098714747135457, 0.026171150652130735, 0.029548493782070195, 0.03325781382569676, 0.03737757532867526, 0.04208281288546001, 0.04727352910962271, 0.0529821857101727, 0.05927771578227156, 0.0664998463892455, 0.07454178567565913, 0.08321428801247685, 0.09229295831933737, 0.10109936177097258, 0.10982904416353438, 0.11853409057297719, 0.1272609458206066, 0.1360219099450205, 0.14480699312266754, 0.15361473273656334, 0.16244521007023874, 0.17130814630486169, 0.1802006240253754, 0.18912126436686244, 0.19807141499055544, 0.20706219286396615, 0.21609163631917827, 0.22515419956102217, 0.2342497582372721, 0.24338515178180847, 0.25255729812951844, 0.2617560432383042, 0.27097872586088445, 0.2802247958538256, 0.2894872743727516, 0.2987556124599631, 0.3080252431317645, 0.3172899550026118, 0.32653607435640875, 0.3357583440316923, 0.34494906944338055, 0.3540967946422238, 0.3631397870245761, 0.37203228423699763, 0.38071844445032077, 0.3891408111131714, 0.3977276527463182, 0.4057157852259043, 0.41316065656152673, 0.42011565221942104, 0.42647163310239966, 0.4324323246180909, 0.4380432057552132, 0.4433246261807553, 0.4481997446145566, 0.45277094422559727, 0.45708646392668373, 0.4611591771057191, 0.4649418942085184, 0.46848565011386273, 0.47183817050430965, 0.47500634080155, 0.4779545521478028, 0.4806862999037841, 0.48324479397702746, 0.48563137616757945, 0.487817778603438, 0.4897871391734717, 0.49159078322308364, 0.49323000494767566, 0.4946872352572306, 0.4959275745670459, 0.49700992662289034, 0.4979357458363021, 0.4986975557412361, 0.49924486203282104, 0.4996431975076077, 0.49989432041240534, 0.5};
  // static const double y_T[] = {0.45, 0.4494794944319172, 0.44829964605991085, 0.44651091304807067, 0.4441635280799612, 0.4411490048880653, 0.43772656354044526, 0.4339678907315148, 0.4299167173609125, 0.4255653292773726, 0.4210526720519618, 0.4164450816313107, 0.4117829235883194, 0.40713132656103485, 0.4025803306539816, 0.39817125598571407, 0.3939473682311475, 0.39003157694574586, 0.38653474761977064, 0.3834516256119836, 0.38083680672645476, 0.37886232018152033, 0.3777486512254121, 0.3774141049147636, 0.37794022712535064, 0.3795453314196175, 0.3827287348283199, 0.3873725799872898, 0.3937272229888939, 0.402212720416108, 0.4144991618855643, 0.4303838477654113, 0.44899896868587647, 0.46930454237608904, 0.4873463357939614, 0.5036610047371626, 0.5185115777017428, 0.5321377915498797, 0.5441695314546555, 0.5550560513037092, 0.564888065360188, 0.5736895293487845, 0.581147374604847, 0.5875375874379745, 0.5929939887542812, 0.5975333391539005, 0.6009165175661537, 0.6032777584906068, 0.6047853561803952, 0.6054498253069145, 0.6050898980079614, 0.6037244457830772, 0.6015547245929572, 0.598586824358939, 0.5946886340708615, 0.5897786151068943, 0.5840933257932519, 0.5776384396307803, 0.5703321442305788, 0.5620831260629839, 0.5532569211134458, 0.5439421728921959, 0.534220103496476, 0.5242720970668235, 0.5143449252874155, 0.5043095867784212, 0.494008237327816, 0.4841180435773471, 0.4756155744654352, 0.46833942856748545, 0.4621337355785085, 0.4571591225284231, 0.45294190855697924, 0.44936770486777666, 0.44637403983907925, 0.44404552752341336, 0.442170745211681, 0.44065333379373495, 0.4394548655054464, 0.4385971613112518, 0.43797628772193486, 0.4375198216447284, 0.43720452335753984, 0.4370320317591272, 0.4369769936621983, 0.4370031379845354, 0.4371013087432195, 0.43727043943654054, 0.4374976506381246, 0.4377577087843371, 0.43804307882824595, 0.43834658277507565, 0.4386535547066741, 0.43895127504430503, 0.4392327676112338, 0.4394889084669748, 0.43969337746243636, 0.4398502241012521, 0.43995415741250216, 0.44};
  // static const double p_T[] = {0.0, -0.0005221811762738234, -0.0016903984587716663, -0.0034386986305623736, -0.005701675290335035, -0.0085380760081868, -0.011695391654364902, -0.015102426723141285, -0.01871240526763499, -0.02250137805391348, -0.026357481697998657, -0.030229755843330656, -0.034082410056376924, -0.03783811945806834, -0.041422992817584804, -0.0448079553650357, -0.04794925912207289, -0.05070543947559343, -0.052945972695039915, -0.05467087662333323, -0.055803106937418745, -0.056105851863318394, -0.05523579627994845, -0.05324572797059415, -0.04996867304612585, -0.04500494437875532, -0.03750295192172132, -0.028771403208713565, -0.01974579391690079, -0.011693464849134935, -0.008096652838158762, -0.009608841923228162, -0.015581559668092364, -0.025147953577067863, -0.033887161306145726, -0.040326422292636936, -0.04474495335837997, -0.047433552081483664, -0.04864226170162168, -0.04891320265234658, -0.04838159296514437, -0.047119798925033665, -0.045014018506738605, -0.042324509370393025, -0.0391673433452299, -0.035584454747168454, -0.03152393465343954, -0.02709288844480279, -0.022375329129212706, -0.01738955699742373, -0.01209836905675343, -0.006521675619597833, -0.0007193547358525908, 0.005306450570424397, 0.011593902684640679, 0.018169320390633514, 0.02496524595390015, 0.031980118974453436, 0.039237383671598305, 0.0468379670040767, 0.054742825809817146, 0.06296365779665464, 0.07152655508536648, 0.08044707375638592, 0.08861282330271482, 0.09514607513241323, 0.09913026550481845, 0.10827762970700391, 0.11883044897732134, 0.13010955980611824, 0.14146426216041477, 0.15186405443091655, 0.16100687198920932, 0.1687808644364465, 0.17504127227096858, 0.17907548486391017, 0.1812561952716907, 0.18184979363440595, 0.18093489882819663, 0.17830781272825558, 0.1745190246957462, 0.16995358444512468, 0.1646996299813687, 0.15859639045380025, 0.1514420860546665, 0.14337600786181987, 0.13438026006653883, 0.12429317279456738, 0.11311144022975897, 0.1012148448690729, 0.0887149708002157, 0.07571196336372758, 0.06252783086556497, 0.04956290149156968, 0.037066257943782, 0.025371001155619598, 0.01557790086372325, 0.0077943311295240415, 0.0024544193404763153, -3.235259282696745e-16};

  // static const int iterationNumber = 100;

  // Silly Walk

  static const double q1_T[] = {0.701158, 0.7034861118035681, 0.7093198546993026, 0.718282048676612, 0.7299925353612031, 0.7435513300370129, 0.7586054872511997, 0.774545554965136, 0.7907898211487209, 0.8067336681487648, 0.8218020015118018, 0.8353816340165188, 0.8463814952760637, 0.8543541456085515, 0.8579822435967357, 0.8557340137376538, 0.8467164228969898, 0.8275099805934245, 0.7981124599847732, 0.7648053615794911, 0.7292950968082474, 0.691586446855402, 0.6523640215446922, 0.6124203153830171, 0.5726726600991422, 0.5341114571164076, 0.4977792498756735, 0.4645126954154523, 0.43627395655963425, 0.41382217067871, 0.3984942007982195, 0.39334874086486893, 0.3987210924714601, 0.41812950511316704, 0.455598083219905, 0.5128324507325439, 0.5964235822894941, 0.6830846055014053, 0.7425471065837785, 0.7760495737103571, 0.7960610530485962, 0.807681707872399, 0.8154923943220105, 0.8232735337222171, 0.8331514250223845, 0.8462144149797306, 0.8624381072015437, 0.8819368102225686, 0.9034877741218249, 0.9260698751733161, 0.948651802316382, 0.9706188167700331, 0.9922101063571966, 1.0153939709355182, 1.0443500221333992, 1.0669881340359384, 1.0045211147922302, 0.9446811654333703, 0.887227806579232, 0.8317198458677753, 0.7783158523731813, 0.7275096978128285, 0.6793738714198456, 0.6349126248296981, 0.5950307496926174, 0.5603286806243443, 0.5332054605424458, 0.5143766862946185, 0.5053341536732382, 0.5101952445026664, 0.5291768747746308, 0.566485682518361, 0.6276208559549888, 0.7079308380151506, 0.773764109619898, 0.8107434783133962, 0.8303989374304841, 0.8377657904833521, 0.8407806235779252, 0.8434293368322998, 0.8489479374318915, 0.8585551595104408, 0.8733508620597566, 0.8931581568538078, 0.9167933434508287, 0.9434972408267355, 0.9715098216598491, 0.9996690674886521, 1.0273219094863417, 1.0551402301793111, 1.0858892606036616, 1.1270832976479523, 1.103093652544136, 1.0403261610035675, 0.9802816891450801, 0.9224876525537075, 0.8673047800694424, 0.814388939269952, 0.764048780810888, 0.7171190756470791, 0.6737904596480684, 0.6354088497688805, 0.6032009986668447, 0.5778536684798117, 0.5623466622102155, 0.5575945780525716, 0.5653079995306391, 0.5909309094714805, 0.6348653591463504, 0.7024922238505198, 0.7773614986107885, 0.8259086053262238, 0.8484675381022935, 0.8558217691817379, 0.8552570193173313, 0.8514614876557358, 0.8486342292848993, 0.8489683930648578, 0.8542671876780955, 0.8642144591080089, 0.8789738230865194, 0.8977033221688463, 0.918962928343876, 0.9418792023018093, 0.9655026545555428, 0.9898708121408734, 1.017140618097011, 1.0511041978578448, 1.0880558656054138, 1.024425141199476, 0.9646425303979828, 0.908163579337646, 0.8545398614577602, 0.8034369102906088, 0.7553871525993343, 0.7101936355350863, 0.6683445300580719, 0.6310274070646974, 0.5984190138677122, 0.5720879900475992, 0.5534589945509015, 0.5431413581108901, 0.5444217019962865, 0.5583090045106298, 0.5865451828316673, 0.6359572929385626, 0.7030875465004709, 0.7567449300274031, 0.7781432339944926, 0.7818336989119546, 0.7740811445891279, 0.7624597266366385, 0.7520029153231437, 0.7470960999781806, 0.7493631362388679, 0.7602228679833023, 0.7814671880673265, 0.8113583965456181, 0.8498123281550175, 0.895528600902844, 0.9464715924384522, 1.0026651461238536, 1.064461304795228, 1.1349094868338225, 1.2203250419533747, 1.2375054427152445, 1.1998646616898185, 1.1721173196223449, 1.1512448945383125, 1.136349823924106, 1.1256584876855262, 1.1176650846149832, 1.1116554143455313, 1.1065040435374551, 1.1015883171764886, 1.0963396164914265, 1.0904183416305526, 1.0834424779150942, 1.0750769032738041, 1.0651841719012232, 1.0531835669283227, 1.0389672424400624, 1.0230485566619394, 1.0096071496009997, 1.0006382358989765, 0.9917577815528764, 0.9833915571416817, 0.9757299047936641, 0.9690508360692242, 0.9634477552516445, 0.9588930420651679, 0.9555985969728379, 0.953376160977727, 0.9521714957727632, 0.9520187804712944, 0.9526278510373525, 0.9538977714210395, 0.9556244392159509, 0.9575305826751336, 0.959326432245099, 0.9606800725685177, 0.9612729378755188};
  static const double q2_T[] = {1.415082, 1.4129855057188008, 1.407680285577895, 1.3993956982538334, 1.3883136277955967, 1.3751460549054944, 1.3599897961750724, 1.3432263817610413, 1.325273785702059, 1.306273260292965, 1.2866798083507642, 1.266812858536242, 1.2470721498304826, 1.2278636103784355, 1.2097538467039646, 1.1934559043277355, 1.1794978356828427, 1.1693069214444936, 1.1634597286379207, 1.1617277334114613, 1.1656477283213078, 1.173777134843286, 1.1853724439312374, 1.199639136511838, 1.215288363099444, 1.231493656011909, 1.2472703943591974, 1.2618142714369704, 1.2738562555939754, 1.2827456441800626, 1.2875656805453182, 1.2863222346324694, 1.2785345255399414, 1.2615485169597909, 1.2318921351746441, 1.187162520768995, 1.1203252365532368, 1.0592291640750462, 1.057625047492537, 1.1130295972599165, 1.1973863419305837, 1.2990014363821107, 1.407118004522982, 1.5130768415160654, 1.61081131341501, 1.6960406338833514, 1.7667061919829867, 1.8166775861321154, 1.845170806969536, 1.8493479349378554, 1.8207702350389663, 1.7601348577746438, 1.6586417771316821, 1.5042879921361598, 1.2871940899034524, 1.0518032767726513, 1.077193468406944, 1.1028696784387766, 1.1288359809403978, 1.1547441548250703, 1.180218778457974, 1.2046733772970404, 1.227701638200757, 1.2484647375672007, 1.2662145033817798, 1.2804770383397763, 1.2896120737541417, 1.2931275553265456, 1.2899674609818808, 1.2771181428377396, 1.2540399879079713, 1.2168973240731698, 1.1600023116858633, 1.086113375340801, 1.0501507865369388, 1.0812218896099486, 1.1523168220765072, 1.2521163724945048, 1.3624250645743439, 1.4741533606348949, 1.5795622372495473, 1.6747710861668184, 1.7548257719550402, 1.8163627668040587, 1.8582025861699178, 1.8733026269254502, 1.8609198018218098, 1.8179998288577297, 1.733240785636128, 1.6064915843519791, 1.4226397777110176, 1.1579591996847878, 1.063578597566176, 1.089337649074324, 1.115246214922463, 1.1411340037271318, 1.1666326674023522, 1.1914116084674438, 1.2149906103232408, 1.2365759722292098, 1.255809147424104, 1.2716646738102153, 1.283243298393287, 1.2900617572216115, 1.290043153744756, 1.2824780715446888, 1.2659673321959668, 1.2360130017105513, 1.1913934844881626, 1.1265579443728702, 1.0626585610050068, 1.057669699002995, 1.1121448198627635, 1.2010647226894648, 1.307755055893693, 1.4214520993202113, 1.5325405831181502, 1.635489570385547, 1.7244897111845239, 1.7982164903219515, 1.8518587726220244, 1.8818798376455577, 1.887369242356696, 1.8599001260589787, 1.7979564481205115, 1.6972269345781872, 1.5393168331499842, 1.3178300819468243, 1.0493927277953792, 1.0732807610682857, 1.0964644739961127, 1.119140267622221, 1.1412784704791419, 1.1627627527843152, 1.1831310985516053, 1.20215084532784, 1.2193345425252253, 1.233788044215126, 1.2452672379077006, 1.2526930785832415, 1.2550743865845047, 1.2519309858324457, 1.240882174976418, 1.2209023824295737, 1.1902279550657446, 1.1426312949194428, 1.0806251560088511, 1.0496796556754737, 1.0912695915993975, 1.1735228752916014, 1.2832363875285833, 1.4042891213739972, 1.526283156462117, 1.6413535605125469, 1.745617399668659, 1.835424632631135, 1.9049477551862766, 1.953788128336754, 1.9759676290541308, 1.9663015485510384, 1.923213630216401, 1.8341581870994605, 1.6939202468069887, 1.4914099140530124, 1.1986003504276284, 1.0593203714040516, 1.077937501142014, 1.0920557173744319, 1.1034968840692125, 1.1130474309810017, 1.1217002076597058, 1.130193100276944, 1.139167142982212, 1.1490167825571131, 1.1600737645340622, 1.1727924637415372, 1.1870783874327886, 1.2031538677320042, 1.2210585862274026, 1.2405364883056684, 1.2616562133728713, 1.284010341470945, 1.3070112970994503, 1.3287316780222618, 1.347426944690939, 1.363891671752927, 1.3780850889897298, 1.3904282172580718, 1.400834848668563, 1.4095046232538744, 1.4167018866922008, 1.422311082168217, 1.4266753035728972, 1.4299183367352732, 1.432040731953895, 1.4333566122883135, 1.433946910784656, 1.4339686145931816, 1.4336468911098301, 1.4331392845703308, 1.4326728329461593, 1.4324492749908149};
  static const double q3_T[] = {0.640798, 0.641820131713583, 0.644394050401257, 0.6483825868548657, 0.653663322545622, 0.6598724766654059, 0.6669253601386981, 0.6746156450756314, 0.6827356511223552, 0.6911786914403993, 0.699749203637506, 0.7083113800640375, 0.7167072556932516, 0.724847385683942, 0.7326253782319905, 0.740004515456357, 0.7471118528195497, 0.7542814532559091, 0.761946806811371, 0.7617016186593043, 0.7389417717148846, 0.7045996726430156, 0.662595199952205, 0.6171477107502085, 0.5721225183652048, 0.5302648229148108, 0.493490558320331, 0.46265975440992296, 0.4401064345460489, 0.42584672016060293, 0.420811417267661, 0.42804214465687046, 0.4475341247366729, 0.4834076475836673, 0.5412886281519879, 0.6254312736822834, 0.750863821791202, 0.8401832975569204, 0.85091429499976, 0.8586937685067754, 0.8642671710724869, 0.8677329682506101, 0.8691815912274846, 0.8691302290624494, 0.8676218388854546, 0.8648437745423738, 0.8610108964790611, 0.8560217630431612, 0.8500667535628817, 0.8432152089934513, 0.8354464684609675, 0.827107059946292, 0.8185414960457155, 0.8105130459746738, 0.8041613188536064, 0.7975273324943652, 0.7752960794815406, 0.7370133616753375, 0.6879689075215292, 0.6354240317812179, 0.5835773399240629, 0.5363148481425163, 0.49527379931764065, 0.46278500896127234, 0.43993652113516296, 0.4266040362889314, 0.4251820987913316, 0.4350671696306615, 0.45701275079550974, 0.49518301260129793, 0.5500116337703429, 0.6281637704749178, 0.7404864703102253, 0.8906435570645479, 0.9120661692077162, 0.9164927644706671, 0.9184489980857555, 0.9177985394855004, 0.9153173945656699, 0.9112774801635771, 0.9058493140013208, 0.8994500126106167, 0.8921343852831178, 0.8840107173428293, 0.8752062646290902, 0.8656486707092386, 0.8554773358248231, 0.8448224504630664, 0.8339178827088064, 0.8233085546678957, 0.813963769344636, 0.8071343329914583, 0.7951928518961594, 0.7640574795149544, 0.7198170071869228, 0.6691495680986274, 0.6172465230832248, 0.5685861476100418, 0.5260691142986237, 0.4926877666139404, 0.4684569064643325, 0.4552602790600349, 0.45375062897356155, 0.46326792052008003, 0.48635721485737327, 0.5227515062361044, 0.5739455273355224, 0.6471378858430237, 0.7453067984850108, 0.8802074913535236, 0.9885418046160988, 0.992627283909563, 0.9935079328200359, 0.9917971801975917, 0.9880042561542136, 0.9821909693458739, 0.9750218767528911, 0.9667399382045572, 0.9574639804817668, 0.9474905805237239, 0.9368519379286364, 0.9256185752191649, 0.9139071773305707, 0.9017511333369492, 0.8893881454242456, 0.877153584278036, 0.8658815544628768, 0.8565995518481441, 0.8485391313329729, 0.826842521923549, 0.7899898699300804, 0.7437655957942847, 0.6942655698731343, 0.645960072848871, 0.6030403741894782, 0.567074273220062, 0.5396617425145271, 0.5231008926151578, 0.5165217732633776, 0.5215029526298417, 0.5387979775977649, 0.5679723649040335, 0.61268263857235, 0.6742875398366851, 0.7564384735620296, 0.8731819613126769, 1.0272726616763994, 1.0581514364260298, 1.0556445768013996, 1.0507185805897061, 1.0434437421505531, 1.034421502705053, 1.0242402799706165, 1.0131933887096298, 1.0017684876739048, 0.9902289334309895, 0.9788062233075497, 0.9676301790669475, 0.9568233496417049, 0.9464703577930252, 0.9366098838060795, 0.9275241255267902, 0.919512198647792, 0.9131121122241929, 0.9085284906468466, 0.8990057187344807, 0.8751128805691366, 0.8402097183836188, 0.8022902234793393, 0.7669293945780962, 0.7377251597854253, 0.7157154701617556, 0.7024264102632667, 0.6957486473448765, 0.6940238347074683, 0.6951002906998677, 0.6959926483088791, 0.6946610264910942, 0.6905448329257429, 0.6857261099325163, 0.6859602479710295, 0.7000286633939993, 0.7383776373200097, 0.7862713288864134, 0.7715073143606888, 0.7584678304615141, 0.7470985320953132, 0.7370521334294954, 0.7283725714797531, 0.720913694332599, 0.7144920181971279, 0.7091982822427366, 0.704801256061663, 0.7012272496266218, 0.6985003276312529, 0.696409388340319, 0.6949258797127069, 0.6939683953820862, 0.6933907551885793, 0.6931373777136581, 0.6930691364320124, 0.6930681438229936};
  static const double q4_T[] = {1.376033, 1.376219580594413, 1.3766269702247378, 1.3770976439056561, 1.377410277304902, 1.37736243873511, 1.3766255890140104, 1.3748887860542405, 1.3719021277252499, 1.3669452314471917, 1.3597546208188582, 1.3497700277888165, 1.3357019957854324, 1.317268608251309, 1.2928625268789984, 1.2605541190518463, 1.2191351517362257, 1.1636239462422349, 1.09410284348509, 1.0473315169785837, 1.0722502356668748, 1.1328698071273644, 1.2191408327273177, 1.3203243147548456, 1.4253743568912265, 1.5276214674655682, 1.6218659899528791, 1.705251665735468, 1.7721449991304643, 1.8214510191710576, 1.8503499569507589, 1.851430054867854, 1.824903405381775, 1.7632371244036593, 1.6570740696991437, 1.499660417247756, 1.2626380291680686, 1.127037261262691, 1.1744976315459954, 1.2128576247266554, 1.2453185969089071, 1.272610410496096, 1.2950571050992314, 1.3137671395056703, 1.3285380859014342, 1.3394461868898717, 1.3466732658261662, 1.3491421866469209, 1.3468173826333372, 1.339001076420633, 1.3234679907674511, 1.2999217693023832, 1.2655129831131962, 1.2163224955677567, 1.1494504314757525, 1.0742869286175916, 1.0534508936106248, 1.0944597245962129, 1.1814783135533575, 1.2906602824095916, 1.4102863744500413, 1.530459880888193, 1.6445945364402559, 1.7471502545730742, 1.8343222638779912, 1.9044409851859674, 1.9507800452275381, 1.9723465351767517, 1.9658258529068873, 1.9206157150682603, 1.8364754201793978, 1.7001963712491441, 1.4914191734190099, 1.205486265880589, 1.220749732797553, 1.2596465141130118, 1.291684415115244, 1.3171273054090655, 1.3379819204602408, 1.3546851628012109, 1.3672142277905177, 1.3763050949998115, 1.3815148785454143, 1.382585102670738, 1.3794713863585935, 1.3706633590975872, 1.3557819125730757, 1.3337619538535137, 1.3011983374843807, 1.2572704809012623, 1.197250458829397, 1.117364496264764, 1.0533189609292684, 1.0644041155994428, 1.1303259967752652, 1.2292440160966571, 1.3486007262427, 1.472793605654458, 1.593940032674333, 1.7050553544874747, 1.8034177601813135, 1.8840525145581564, 1.9433818209780624, 1.9801794094492196, 1.9862773667971816, 1.9602325820783486, 1.8979019273074287, 1.7833706069888975, 1.612437632357385, 1.3641389057969, 1.1821066314307558, 1.227769610064738, 1.264113569838147, 1.2936313782900901, 1.3179564954446397, 1.3370794838568651, 1.3523298007479396, 1.3638885556548248, 1.3713995373712846, 1.3753301113621845, 1.3749657604409464, 1.3696984438338675, 1.3592718516063749, 1.3415851049914145, 1.31579650520091, 1.2802659508273067, 1.2294773039147153, 1.1612136988764534, 1.080791955760512, 1.0516204657622854, 1.0858243681022146, 1.1646747075617874, 1.2686983313284812, 1.3833619945250906, 1.4989622143951777, 1.6083979494522078, 1.707006326772895, 1.789121270636477, 1.8539496188995848, 1.8964190047772047, 1.9125203283758863, 1.901145046936167, 1.8522985900136288, 1.7626386164681414, 1.6245026411545218, 1.4079662490115303, 1.1140635626134192, 1.0964835171975877, 1.1360221005937454, 1.1676804663280032, 1.1925191762141223, 1.2122657127883092, 1.2282130804705857, 1.2404003283285465, 1.2497466537474322, 1.256363439925443, 1.2598338134044134, 1.2603798122619314, 1.2572234708566619, 1.2495287557843306, 1.2368194450022503, 1.2167401506924975, 1.1879769747547082, 1.148459323355721, 1.0926669302118408, 1.051674012381904, 1.0834589439442968, 1.1818354976631045, 1.3148257961006897, 1.4656826097298352, 1.6193500601482356, 1.7674774976968164, 1.9023069756391995, 2.021091279134917, 2.1197770662957827, 2.1904889121151703, 2.232768962883441, 2.2387556620064775, 2.201989400518719, 2.1216769595036604, 1.9831250768057445, 1.7792411263076824, 1.4997329767425285, 1.2471989021386696, 1.2730938259569458, 1.2941002543671187, 1.311089617801495, 1.3254116172058696, 1.3374288656501034, 1.3477454567694318, 1.3568631796147081, 1.364904689977859, 1.3722312502094158, 1.3789810678229522, 1.38517550269391, 1.3909354078931484, 1.396203261525997, 1.4008948688332257, 1.404964413932452, 1.4081308697112465, 1.4102384174910505, 1.411096194721022};

  static const double x_T[] = {0.0, 3.355654462684818e-05, 0.0001251207660932014, 0.0002833182237245953, 0.0005206111512949726, 0.0008330034159379521, 0.001237477657485923, 0.0017405117372871555, 0.002342450810126096, 0.0030732941776204213, 0.003928669860353424, 0.004920552768212986, 0.006086927314793078, 0.007417498450048491, 0.008946654414107635, 0.010705308445919902, 0.01269314006076915, 0.014978486524154143, 0.01754153726424255, 0.020293852265882876, 0.023290271777509, 0.02648735517134925, 0.029874868012715848, 0.03344767597393843, 0.03716618494511796, 0.04103635158393221, 0.04504659013053189, 0.049178512625881264, 0.05344634387509768, 0.05782700975519283, 0.06231351874722456, 0.06691482043399731, 0.07160573595476678, 0.07638320840710983, 0.08123347806190287, 0.08612365412783468, 0.09097773131342306, 0.09586806098038185, 0.10088038818841706, 0.10574190285085061, 0.11049194297443661, 0.11513560948608907, 0.11968032696012565, 0.12415923677192914, 0.1285890159869234, 0.13299597191979287, 0.13740489512861073, 0.14184503167210083, 0.14633983817351762, 0.15091590605275954, 0.15562632390846418, 0.1604885655763542, 0.16555993666291527, 0.1709004322250098, 0.17651679679262108, 0.1824137546102025, 0.1887115264280052, 0.19512773290581756, 0.2016811183637792, 0.20833455993015448, 0.21508275088411674, 0.22193038487707026, 0.22886213083575646, 0.23588598378817008, 0.24299816554387543, 0.2501863558923447, 0.2574559163664295, 0.26478916787673373, 0.2721760776203503, 0.2796131414160204, 0.28707920881267573, 0.2945551667091719, 0.301993551029814, 0.3092720937084688, 0.3167449656482305, 0.3240404467094598, 0.33114851525087474, 0.33804577506738637, 0.3447808892878728, 0.3513682218685264, 0.35782019547349697, 0.36418170585981113, 0.3704708238135235, 0.37671651591802774, 0.3829483638342329, 0.3891974358892091, 0.3954953169393759, 0.4018754324363845, 0.40840289249673484, 0.4150995614668113, 0.4220215910990172, 0.4291751939209687, 0.43668121213265587, 0.4444141323198629, 0.4522287070868729, 0.460108742311232, 0.4680526210778505, 0.47604463744958747, 0.48408513845750856, 0.4921794658967958, 0.5003184635737369, 0.5085023757929636, 0.5167233013527075, 0.5249680446964199, 0.5332258754427658, 0.5414801282114957, 0.5497146958153903, 0.5578973364183509, 0.5659972638177406, 0.5739309149302144, 0.581766842680886, 0.589708196086071, 0.5973740293280186, 0.6047920281499846, 0.611989879298322, 0.6189442682928831, 0.6257132693496392, 0.6323153322852371, 0.6387589545110769, 0.6450911281721575, 0.6513253621683966, 0.657487551811174, 0.6636092980691438, 0.6697172090391553, 0.6758466573738017, 0.6820301029775928, 0.6883192811408155, 0.6947192715629525, 0.7012425822664284, 0.7082339018077025, 0.7153269021347504, 0.722525632857098, 0.729806753111624, 0.7371508406743711, 0.7445595322936196, 0.7520175819635496, 0.7595208233286632, 0.767067120476407, 0.7746413032379076, 0.7822340864603363, 0.7898303280725893, 0.7974139647912953, 0.8049603182815515, 0.8124464661880855, 0.8198407795119854, 0.8270487295398343, 0.83397716609734, 0.8411362312593029, 0.8480863712461655, 0.8547551263306141, 0.8611112979955965, 0.8671756292264777, 0.8729820087776784, 0.8784989011265203, 0.8837805662849226, 0.8888336395828792, 0.8936353044806161, 0.8982254714142988, 0.90258300109389, 0.9067026290050585, 0.9106079665150397, 0.9142645940537494, 0.9176894597313581, 0.9208736986792996, 0.9237763936528239, 0.9269150607587789, 0.9302133903760081, 0.9333864798303557, 0.9364519518153093, 0.9394020030029874, 0.9422565051739517, 0.9450428765674675, 0.9477762443762756, 0.9504869019322181, 0.9531933891404972, 0.9559135761283288, 0.958657139052733, 0.9614356046751156, 0.9642590186955338, 0.9671306751695421, 0.9700622917421046, 0.9730366015498317, 0.9760039423429426, 0.9788038761625664, 0.9813788325249554, 0.9837588537612548, 0.9859368242470846, 0.98794547025421, 0.9897703911409852, 0.9914231611648998, 0.9929227743121267, 0.9942471609513415, 0.9954243866732544, 0.9964587980228156, 0.9973357528309575, 0.99808452143939, 0.9986989113971904, 0.9991816397619544, 0.9995525978124262, 0.9998020562932834, 0.9999469228924203, 1.0};
  static const double y_T[] = {0.45, 0.45018174361678626, 0.45064560958782246, 0.4513799843871607, 0.45238174493348315, 0.4535985114385257, 0.45504389203715645, 0.45670572250576863, 0.45856552522343164, 0.4606660554106691, 0.46298950740191525, 0.46555345977925283, 0.46842632375806215, 0.47159662442978256, 0.47514045638686725, 0.47913945748444037, 0.48362353823291343, 0.4887944705289494, 0.4944734167065318, 0.4995642798395087, 0.5032677909998419, 0.5060030957854768, 0.5078250370870598, 0.5087751243154796, 0.5090747266550313, 0.5087549323913788, 0.5079306099387165, 0.5067312681704985, 0.5051954808582266, 0.5034584523640735, 0.5016129067140833, 0.49976782241595114, 0.4980460189530612, 0.4966152332056043, 0.4956980483804759, 0.49546855507480175, 0.496208808629021, 0.4969460100429602, 0.49719335203619575, 0.49710170366287476, 0.4967885718518493, 0.4962896934005786, 0.49564941132290286, 0.4949413448862168, 0.4942147985828516, 0.4935264851207384, 0.49292280458468535, 0.4924837153911685, 0.4922539212800608, 0.49229852386883677, 0.4927678647719415, 0.49370673781670416, 0.49530415473822365, 0.4978066641065849, 0.50136948085136, 0.5052843916019828, 0.5081824972252404, 0.5101812920120279, 0.5112554413880819, 0.5116461415309728, 0.5114143408736603, 0.5106013172341504, 0.5093742093884553, 0.5077763608516938, 0.5059015196060038, 0.503854713056458, 0.5017094928097539, 0.49957675639300564, 0.49755860826180265, 0.4958288137042142, 0.4944991758691345, 0.493806177908792, 0.4940604153324409, 0.4949091757297044, 0.4952577614145399, 0.49524065671183, 0.49500561418084715, 0.49456554743895964, 0.49400861577324445, 0.49338559701819645, 0.4927521759416587, 0.4921603745505224, 0.4916666338202712, 0.49132412862446573, 0.4911686445598866, 0.4913015619795289, 0.4917669709301297, 0.4926422663641182, 0.4941438058126404, 0.4963305816598703, 0.49947764796298794, 0.503631552753107, 0.5074223929399926, 0.510118728898723, 0.5119158849550659, 0.5129697174030449, 0.5132475643173604, 0.5129668760761961, 0.5121993482706005, 0.5109902837148963, 0.509485573177711, 0.5077408399049689, 0.5058477890297811, 0.5039052545552364, 0.502018701909433, 0.5002999226237101, 0.4988701226925995, 0.4979863568230529, 0.497778632366876, 0.4984626042685604, 0.4991870196987757, 0.49940004405668564, 0.49929116239238025, 0.4989517260725144, 0.4984482777419947, 0.49782139334278686, 0.4971507144303124, 0.4964896467245413, 0.49590241277197905, 0.495431376964492, 0.49514669970564684, 0.4951155790304925, 0.4953798121630776, 0.496086983314361, 0.49730756164112655, 0.4991561440513875, 0.5019843591565659, 0.5058896828685548, 0.5103038989288999, 0.5137937894633244, 0.51641993964102, 0.5182081145674458, 0.5192815130811602, 0.5197707098830726, 0.5196627612612447, 0.5191248216521998, 0.5182203033647989, 0.5169876013363328, 0.5155468394683925, 0.5139553750387712, 0.5122997041579357, 0.5106721504974316, 0.5091987083826032, 0.5079991596836334, 0.5072115190275913, 0.5071509837693262, 0.5074699204797694, 0.5075840998374838, 0.5073248149662393, 0.5068183663749826, 0.5060806402557423, 0.505182477711617, 0.5041937621466444, 0.503168194311379, 0.5021683782602911, 0.5012454972411028, 0.5004705248488414, 0.49987354728715955, 0.49953003040466415, 0.499514291152123, 0.49986824116002126, 0.5007706895397372, 0.5023213929006805, 0.5046662136433776, 0.5079226174652348, 0.5108668594480353, 0.5130228595770124, 0.51435214434398, 0.5150197444365413, 0.5150179708501221, 0.5144438763995421, 0.5133984890128802, 0.5118508799515523, 0.509908329797047, 0.5075963767257562, 0.5048929683179229, 0.5018800376961138, 0.4985567650783103, 0.4949601640490903, 0.49117479525605445, 0.4872657517358808, 0.4833573009236291, 0.47951638856005413, 0.47550611770448203, 0.47147232337513334, 0.4680226222412876, 0.4651048040295742, 0.46257904057119614, 0.46042919425163487, 0.45858995481930925, 0.4569961451092267, 0.45565099799131137, 0.4544914855535389, 0.4534947983979369, 0.45266082327028806, 0.45194870226368855, 0.4513572579904146, 0.45088024561762735, 0.45050040422228016, 0.45023071862713215, 0.45006428240997565, 0.45000000000000007};
  static const double p_T[] = {0.0, -0.0012084913024514004, -0.004227444331695213, -0.00883831668463602, -0.014804743841625865, -0.021628518147450402, -0.029058232129684582, -0.036714717220780645, -0.04424597685017391, -0.05118387005399736, -0.05718009633627281, -0.061805468427605315, -0.06424021657522594, -0.06422315147245315, -0.06079613917161638, -0.0528742610897588, -0.0398825534091827, -0.019403730007667, 0.008118657411672942, 0.03659131471949285, 0.06327542685392668, 0.08910658636806293, 0.11381855060170312, 0.13705582451798906, 0.15877216261597715, 0.1784537105966221, 0.19572529533843835, 0.2103573055197146, 0.22124146809398276, 0.22819565723891497, 0.2305981610035686, 0.2268185288786181, 0.2169188326700908, 0.19914988560427727, 0.17163501759756347, 0.13388675652731158, 0.08307803505678345, 0.0289357480787957, -0.017950471533839888, -0.05632891840443538, -0.08898084285573943, -0.11650486816776544, -0.13925216702611673, -0.15843105170680769, -0.1740322891422035, -0.18633588967917544, -0.19568541759423386, -0.20144455673380895, -0.2037845746681618, -0.20239709089965155, -0.19605858360145043, -0.1848864920470547, -0.16759754452134973, -0.1426624866772231, -0.10943057406709683, -0.06963416085700941, -0.03177010260809174, 0.0024096521124551337, 0.03308762257837441, 0.06113873800214951, 0.08664317047376986, 0.10942235722829417, 0.12978331561597478, 0.1472152522518433, 0.16135973037679993, 0.17206030105510073, 0.17802073683748124, 0.17903228986526237, 0.17441106772835352, 0.1620661115258196, 0.14214563150817475, 0.11275351851247692, 0.07158806925247035, 0.021231081332189115, -0.02664909985055533, -0.0659707195720731, -0.0988752782799334, -0.12542995549207303, -0.1475792652270172, -0.16586498686755827, -0.18047521136621408, -0.19225587927032503, -0.20104573997642872, -0.2068312106811967, -0.20972056490220517, -0.20883059799596287, -0.20407206123940902, -0.19496042975485675, -0.17979310378605134, -0.15855622413129225, -0.12942724793572385, -0.09130502157310802, -0.05161198103721118, -0.01626637173351593, 0.015454323210273917, 0.04426580660931616, 0.06996560465844538, 0.09324041955896402, 0.11406942527080259, 0.1320566715636777, 0.14736402110424562, 0.15929609895617583, 0.16729407423415094, 0.17113492118768847, 0.16925680901476642, 0.16134433139184212, 0.1466482171716325, 0.12254928399204448, 0.08923000691861344, 0.04437559498374874, -0.005373528695472413, -0.04800925451027417, -0.08220568054895824, -0.11001652617170064, -0.1328738832784159, -0.1508408673118527, -0.16532113641740923, -0.17666563659902274, -0.18481094463798145, -0.19031941489576099, -0.1928446115522023, -0.19213073259392213, -0.18814887465735142, -0.17977055473231968, -0.1667329737369123, -0.14841028372034618, -0.12245259817297456, -0.08851068754049278, -0.04784954780613979, -0.00938567862606928, 0.02474384792930525, 0.05503176823921358, 0.08210840545525078, 0.10650592265814374, 0.12793040616047513, 0.14685212898006478, 0.1631193001860856, 0.17611585020284634, 0.18596576515338809, 0.19185794685117205, 0.1931213969395297, 0.18957802574167185, 0.17956377919187846, 0.16276025065249092, 0.13850190034357182, 0.10370108751871623, 0.06004426664224448, 0.01968154979438195, -0.010704733257053744, -0.034304553899075226, -0.05172892450106314, -0.06448235684818958, -0.07383365981908449, -0.08002824874038457, -0.08406336356177883, -0.08624005511001309, -0.08650608344518142, -0.08513958316275379, -0.08179076450407403, -0.07606147443730542, -0.06774795082006947, -0.05576349889373749, -0.03968190493446578, -0.018853187531561864, 0.00969190057806066, 0.039750565736660574, 0.06240763304674764, 0.0773502718286856, 0.08686278259649659, 0.09155540462342508, 0.09272117323190998, 0.09146259160134708, 0.08816545775517926, 0.08368941055617515, 0.07845380676068446, 0.07277058076179506, 0.06699055998624087, 0.06135959379070034, 0.05616255898829661, 0.05163949320067482, 0.048295979385737695, 0.046451217041378674, 0.045958085917945396, 0.0438699168973402, 0.03912088945649607, 0.03561852181506121, 0.03298777766214111, 0.030804038915405608, 0.02886792591112023, 0.026984155206712192, 0.025030814055510418, 0.022901193061429907, 0.020575119683522776, 0.018045218064390182, 0.015311575422543045, 0.012460469724649658, 0.009570681617366694, 0.006769957729253883, 0.004190508540764236, 0.0020727509875254828, 0.0006093650268590982, 4.52437566578201e-16};

  static const int iterationNumber = 202;

  iterationCount++;

  if (iterationCount >= iterationNumber) {
    iterationCount = 0;
  }

  float q1 = q1_T[iterationCount];
  float q2 = q2_T[iterationCount];
  float q3 = q3_T[iterationCount];
  float q4 = q4_T[iterationCount];

  float x = x_T[iterationCount];
  float y = y_T[iterationCount];
  float p = p_T[iterationCount];

  float roll = 0;
  float pitch = -p;
  float yaw = 0;

  float cy = cos(yaw * 0.5);
  float sy = sin(yaw * 0.5);
  float cp = cos(pitch * 0.5);
  float sp = sin(pitch * 0.5);
  float cr = cos(roll * 0.5);
  float sr = sin(roll * 0.5);

  // new_state_est.body.pose.pose.orientation = last_imu_msg_->orientation;
  new_state_est.body.pose.pose.orientation.x = sr * cp * cy - cr * sp * sy;
  new_state_est.body.pose.pose.orientation.y = cr * sp * cy + sr * cp * sy;
  new_state_est.body.pose.pose.orientation.z = cr * cp * sy - sr * sp * cy;
  new_state_est.body.pose.pose.orientation.w = cr * cp * cy + sr * sp * sy;

  // new_state_est.joints = *last_joint_state_msg_;

  new_state_est.joints.name.push_back("0");
  new_state_est.joints.name.push_back("1");
  new_state_est.joints.name.push_back("2");
  new_state_est.joints.name.push_back("3");
  new_state_est.joints.name.push_back("4");
  new_state_est.joints.name.push_back("5");
  new_state_est.joints.name.push_back("6");
  new_state_est.joints.name.push_back("7");
  new_state_est.joints.name.push_back("8");
  new_state_est.joints.name.push_back("9");
  new_state_est.joints.name.push_back("10");
  new_state_est.joints.name.push_back("11");

  new_state_est.joints.position.push_back(q3);
  new_state_est.joints.position.push_back(3.14159 - q4);
  new_state_est.joints.position.push_back(q1);
  new_state_est.joints.position.push_back(3.14159 - q2);
  new_state_est.joints.position.push_back(q3);
  new_state_est.joints.position.push_back(3.14159 - q4);
  new_state_est.joints.position.push_back(q1);
  new_state_est.joints.position.push_back(3.14159 - q2);
  new_state_est.joints.position.push_back(0);
  new_state_est.joints.position.push_back(0);
  new_state_est.joints.position.push_back(0);
  new_state_est.joints.position.push_back(0);
  
  // new_state_est.body.pose.pose.position = last_mocap_msg_->pose.position;
  new_state_est.body.pose.pose.position.x = x;
  new_state_est.body.pose.pose.position.y = 0;
  new_state_est.body.pose.pose.position.z = y;

  new_state_est.header.stamp = ros::Time::now();
  return new_state_est;
}

void TrajectoryVisualizationPublisher::spin() {
  ros::Rate r(10);
  while (ros::ok()) {

    // Collect new messages on subscriber topics
    ros::spinOnce(); 

    // Compute new state estimate
    spirit_msgs::StateEstimate new_state_est = this->updateStep();

    // Publish new state estimate
    ground_truth_state_pub_.publish(new_state_est);

    // Store new state estimate for next iteration
    last_state_est_ = new_state_est;

    // Enforce update rate
    r.sleep();
  }
}
