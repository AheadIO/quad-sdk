<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quad-SDK: Quad Utils</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Quad-SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Quad Utils </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p >This package implements a collection of utility functions to aid quad kinematic calculations, interfacing between RViz and quad-sdk topics, remote heartbeat function, and various launch files. The detail functionalities of different classes can be found in <a href="#classes-and-functions">Classes and Functions</a> section. Methods to use various launch files are explained in <a href="#launch-files">Launch Files</a> section.</p>
<h2>License</h2>
<p >The source code is released under a <a href="quad-sdk/LICENSE">MIT License</a>.</p>
<p >**Author: Joe Norby<br  />
 Affiliation: <a href="https://www.cmu.edu/me/robomechanicslab/">Robomechanics Lab</a><br  />
 Maintainers: Alex Stutt (<a href="#" onclick="location.href='mai'+'lto:'+'ast'+'ut'+'t@a'+'nd'+'rew'+'.c'+'mu.'+'ed'+'u'; return false;">astut<span style="display: none;">.nosp@m.</span>t@an<span style="display: none;">.nosp@m.</span>drew.<span style="display: none;">.nosp@m.</span>cmu.<span style="display: none;">.nosp@m.</span>edu</a>) and Qishun Yu (<a href="#" onclick="location.href='mai'+'lto:'+'qis'+'hu'+'ny@'+'an'+'dre'+'w.'+'cmu'+'.e'+'du'; return false;">qishu<span style="display: none;">.nosp@m.</span>ny@a<span style="display: none;">.nosp@m.</span>ndrew<span style="display: none;">.nosp@m.</span>.cmu<span style="display: none;">.nosp@m.</span>.edu</a>)**</p>
<p >The Quad Utils package has been tested under <a href="http://www.ros.org">ROS</a> Melodic 18.04. This is research code, expect that it changes often and any fitness for a particular purpose is disclaimed.</p>
<h1>Classes and Functions</h1>
<ul>
<li><code>quad_kd.cpp</code> - QuadKD is our kinematics and dynamics library to aid in performing those types of calculations. Some methods are written by hand, others implement RBDL as a backend (mostly for Jacobian and inverse dynamics computation).</li>
</ul>
<h2>QuadKD guide</h2>
<p >The general naming convention for coordinate transformations is</p>
<div class="fragment"><div class="line">QuadKD::proximallinkToDistallinkFK/IKCoordFrame();</div>
</div><!-- fragment --><p >So for example <code>QuadKD::worldToFootFKWorldFrame();</code> would give the coordinates of the foot frame origin relative to the world frame origin expressed the world frame for a given set of body and joint positions , while <code>QuadKD::legbaseToFootIKLegbaseFrame();</code> would give the joint positions corresponding to a given foot location specified in the legbase frame.</p>
<h2>Alternative way to use a quad_kd function:</h2>
<p >Here is another example of computing rotation matrix given roll pitch and yaw using <code>getRotationMatrix</code> in <code>quad_kd.cpp</code>:</p>
<div class="fragment"><div class="line"><span class="comment">// initialize a shared pointer to QuadKD class in header file</span></div>
<div class="line">std::shared_ptr&lt;quad_utils::QuadKD&gt; quadKD_;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// make a kinematics object in the cpp file</span></div>
<div class="line">quadKD_ = std::make_shared&lt;quad_utils::QuadKD&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// call the function</span></div>
<div class="line">quadKD_-&gt;getRotationMatrix(rpy, rot);</div>
</div><!-- fragment --><ul>
<li><code>rviz_interface.cpp</code> - A class for interfacing between RViz and quad-sdk topics.</li>
<li><code>remote_heartbeat.cpp</code> - A class for implementing a remote heartbeat to publishe stamped messages at a fixed rate.</li>
</ul>
<h1>Launch Files</h1>
<p >Launch files are divided across system functionality:</p>
<ul>
<li><code>mapping.launch</code> - launches nodes terrain_map_publisher and grid_map_visualization</li>
<li><code>planning.launch</code> - launches nodes global_body_planner and local_planner. Takes arg <code>global_planner</code> with values of <code>twist</code> (default) or <code>fgmp</code>, arg <code>local_planner</code> with values of <code>full</code> (default) and <code>body</code>, and arg <code>mpc_type</code> of value <code>nonlinear</code> (default) or <code>convex</code></li>
<li><code>control.launch</code> - launches node inverse_dynamics or open_loop_controller. Takes arg <code>controller</code> with values of <code>inverse_dynamics</code> (default) or <code>open_loop</code></li>
<li><code>estimation.launch</code> - launches nodes ekf_estimator, contact_detection, and body_force_estimation</li>
<li><code>mocap.launch</code> - launches node mocap_node with config file and ground_truth_publisher</li>
<li><code>visualization.launch</code> - launches nodes robot_state_publisher which remaps from imu data, rviz_interface which remaps from /state/ground_truth (can be set to /state/estimate or /state/trajectory), and rviz</li>
<li><code>logging.launch</code> - launches two record nodes to record two bags - one in <code>quad_logger/bags/archive/quad_log_&lt;timestamp&gt;.bag</code>, the other in <code>quad_logger/bags/quad_log_current.bag</code></li>
</ul>
<p >There are four main high-level launch files, one each for the robot and remote computers, one for gazebo, and one to execute plans:</p>
<ul>
<li><code>robot_driver.launch</code> - should be run on the robot and calls <code>control.launch</code> and <code>estimation.launch</code>. Has args <code>proxy</code>, <code>mocap</code>, and <code>logging</code>, each of which default to false. Setting any of these to true calls the corresponding launch files. It also passes arg <code>controller</code> to <code>control.launch</code> (default inverse_dynamics)</li>
<li><code>remote_driver.launch</code> - should be run on the remote computer and calls <code>mapping.launch</code> and <code>visualization.launch</code>, as well as mblink_converter. Has arg <code>proxy</code> (default false) which if true will call <code>robot_driver.launch</code> with <code>proxy:=true</code> and passing the other args through (<code>mocap</code> and <code>logging</code>)</li>
<li><code>quad_gazebo.launch</code> - see the Gazebo Simulator page for details.</li>
<li><code>execute_plan.launch</code> - Calls <code>planning.launch</code> with arg <code>body_planner</code> (default global), and <code>logging.launch</code> if <code>logging:=true</code> (default false)</li>
</ul>
<h2>Common roslaunch calls:</h2>
<p >Launch the simulator with RViz visualization, stand the robot up, then execute a plan while logging:</p>
<div class="fragment"><div class="line">roslaunch quad_utils quad_gazebo.launch</div>
<div class="line">rostopic pub /control/mode std_msgs/UInt8 &quot;data: 1&quot;</div>
<div class="line">roslaunch quad_utils planning.launch global_planner:=twist logging:=true</div>
<div class="line">(for twist control input) rosrun teleop_twist_keyboard teleop_twist_keyboard.py</div>
</div><!-- fragment --><p >If your computer is not that powerful, you can slow down the simulation and relax the MPC solving time constraint by:</p>
<ol type="1">
<li>change real_time_update_rate in the .world file (eg. <a href="https://github.com/robomechanics/quad-software/blob/main/quad_simulator/gazebo_scripts/worlds/flat/flat.world">flat.world</a>)</li>
<li>change line 91 and 92 of <a href="https://github.com/robomechanics/quad-software/blob/main/nmpc_controller/src/nmpc_controller.cpp">nmpc_controller.cpp</a> make it match the actual time step you have</li>
</ol>
<p >Test the full stack without simulating or logging:</p>
<div class="fragment"><div class="line">roslaunch quad_utils remote_driver.launch proxy:=true</div>
<div class="line">roslaunch quad_utils execute_plan.launch</div>
</div><!-- fragment --><p >Other calls:</p>
<ul>
<li><code>roslaunch quad_utils robot_driver.launch mocap:=true</code> - Start the robot stack with the inverse_dynamics controller and mocap data</li>
<li><code>roslaunch quad_utils remote_driver.launch</code> Start the remote stack to begin sending commands to the robot and visualizing data</li>
<li><code>roslaunch quad_utils remote_driver.launch proxy:=true</code> - Test the remote stack with robot absent</li>
<li><code>roslaunch quad_utils remote_driver.launch proxy:=true body_planner:=twist</code> - Test the full stack with robot absent and with simple twist-based high level body plan</li>
<li><code>roslaunch quad_utils open_loop_robot_driver.launch</code> - Only launch open_loop_controller and mblink_converter nodes</li>
<li><code>roslaunch quad_utils quad_gazebo.launch gui:=true</code> - Launch the Gazebo sim and visualize the results (need to call other launch files to get it to run our software).</li>
</ul>
<h1>Bugs &amp; Feature Requests</h1>
<p >Please report bugs and request features using the <a href="https://github.com/robomechanics/quad-sdk/issues">Issue Tracker</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
